/*
 * File: app/controller/DataDetailController.js
 *
 * This file was generated by Sencha Architect version 2.0.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Sencha Touch 2.0.x library, under independent license.
 * License of Sencha Architect does not include license for Sencha Touch 2.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */
var map;
var buttonPressed;
var geocoder;

Ext.define('MyApp.controller.DataDetailController', {
    extend: 'Ext.app.Controller',
    
	launch: function()
			{
	            map=this.getMapView().getMap();
	            buttonPressed=false;
	            geocoder = new  google.maps.Geocoder();
	        },
    config: {
        refs: {
            dataList: '#dataList',
            dataView: '#dataView',
            detailContainer: '#detailContainer',
            mainTabPanel: '#mainTabPanel',
            mapView: '#mapView'
        },

        control: {
            "#dataList": {
                itemtap: 'onListItemTap'
            },
            "#detailButton":{
            	tap: 'onDetailButtonTap'
            },
            "#mainTabPanel":{
            	activeitemchange:'onTapPanelPressed'
            }
        }
    },

    onListItemTap: function(datalist, index, target, record, e, options) {
        var rec = datalist.getStore().getAt(index);
      //  alert(dataView);
        //this.detailContainer.setActiveItem(1,'slide');
	  	this.getDataView().setRecord(record);
	    //this.getDataView().doLayout();

    },
   
    onDetailButtonTap: function(button,event,object)
	{
	 //alert(this.getDataView().getRecord().data.desc);
	 buttonPressed=true;
	 this.getMainTabPanel().setActiveItem(1);
	 //alert('pressed');
	
	 geocoder.geocode( { 'address': 'Landstrasser Hauptstrasse 100 1030 Wien'}, geocodeCallback);
	 
	},
	
	onTapPanelPressed: function(container,value,oldValue,eopts)
	{
	 	
		if(!buttonPressed)
		{
			//Store infos rausholen und geocoden;
			geocoder.geocode( { 'address': 'Landstrasser Hauptstrasse 10 1030 Wien'}, geocodeCallback);
			geocoder.geocode( { 'address': 'Landstrasser Hauptstrasse 20 1030 Wien'}, geocodeCallback);
			geocoder.geocode( { 'address': 'Landstrasser Hauptstrasse 30 1030 Wien'}, geocodeCallback);
		}
		buttonPressed=false;
	  
	}

});

var geocodeCallback=function(results, status)
{
		if (status == google.maps.GeocoderStatus.OK) {
        map.setCenter(results[0].geometry.location);
        var marker = new google.maps.Marker({
            map:  map, 
            position: results[0].geometry.location
        });
      } else {
        alert("Geocode was not successful for the following reason: " + status);
      }
}


